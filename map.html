<html>
<head>
<title>VAR Map</title>
<style type="text/css">
#inst {
  font: 400 18px Roboto, Arial, sans-serif;
  background: rgb(255, 255, 255) none repeat scroll 0% 0%;
  margin: 10px;
  position: absolute;
  user-select: none;
  border-radius: 2px;
  height: 40px;
  padding: 0px 17px;
  box-shadow: rgba(0, 0, 0, 0.3) 0px 1px 4px -1px;
  border: 0px;
  top: 0;
  z-index: 10;
  place-content: center;
  display: grid;
  right: 90px;
}

#map {
  height: 100%;
}

html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}
</style>
</head>
<body>
<link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Google+Sans:400,500,700">	
<div id="inst">Click to post to VAR.</div>
<div id="map"></div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkUOdZ5y7hMm0yrcCQoCvLwzdM6M8s5qk"></script>
<script type="text/javascript">
var lat = 0;
var lng = 0;

var time = "";
var label = "";

var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
var labelIndex = 0;

function initialize() {
  var israel = { lat: 31.771959, lng: 35.217018 };
  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 12,
    center: israel
  });


  google.maps.event.addListener(map, 'click', function(event) {
    addMarker(event.latLng, map);
    sendMarker(lat, lng, label);
  });
}

function addMarker(location, map) {
  label = labels[labelIndex++ % labels.length];
  var marker = new google.maps.Marker({
    position: location,
    label: label,
    map: map
  });
  lat = marker.getPosition().lat().toFixed(6);
  lng = marker.getPosition().lng().toFixed(6);
}

google.maps.event.addDomListener(window, 'load', initialize);

function sendMarker(lat, lng, label) {
  var d = new Date();
  time = d.getHours()+":"+d.getMinutes()+":"+d.getSeconds();
	var data = `
  {
  "POintList": [
    {
      "Centerloc": {
        "lat": `+lat+`,
        "lng": `+lng+`
      },
      "x": 0,
      "y": 0,
      "desc": "Point`+label+`",
      "id": 0,
      "user_id": "map",
      "dtime": "`+time+`"
    }
  ]
}`;
var xhr = new XMLHttpRequest();
  xhr.open("PUT", "https://jsonblob.com/api/var/d1d0be40-90ff-11ea-bb21-f9b978970334", true);
  xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');

  //xhr.send(JSON.stringify(data));
  xhr.send(data);

  xhr.onloadend = function () {
  	console.log("Marker sent.\nlat: "+lat+", lng: "+lng+", label: Point"+label+", time: "+time+".");
  };
}
</script>
</body>
</html>
